<!DOCTYPE html>
<html>
<head>
  <title>Habit Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
  --pink-50: #fff0f6;
  --pink-100: #ffd6e7;
  --pink-300: #ff8abf;
  --pink-500: #ff3d8f;
  --pink-700: #d6336c;

  --bg-gradient: linear-gradient(160deg, #ffeef7, #ffd6e7);
  --glass-bg: rgba(255, 240, 245, 0.5);
  --card-bg: rgba(255, 255, 255, 0.9);
  --text-primary: #2b0a12;
  --text-light: #3b0f1a;
  --input-bg: #fff6fa;
    --button-bg: linear-gradient(90deg, var(--pink-500), var(--pink-700));
    --li-bg: linear-gradient(180deg, rgba(255,255,255,0.92), var(--pink-50));
  --space: 12px;
}

body.dark {
  --bg-gradient: linear-gradient(160deg, #2b0a12, #401124);
  --glass-bg: rgba(40, 10, 20, 0.45);
  --card-bg: rgba(30, 10, 18, 0.9);
  --text-primary: #ffeef7;
  --text-light: #ffd6e7;
  --input-bg: #3a0d17;
    --button-bg: linear-gradient(90deg, #ff6fa1, #d6336c);
    --li-bg: linear-gradient(180deg, rgba(40,10,18,0.9), rgba(30,8,15,0.8));
}

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg-gradient);
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: background 0.4s ease;
}

.app {
  width: 380px;
  height: 720px;
  background: var(--glass-bg);
  backdrop-filter: blur(25px);
  border-radius: 32px;
  padding: 28px;
  box-shadow: 0 40px 80px rgba(0,0,0,0.3);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  transition: background 0.4s ease;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.date {
  font-size: 14px;
  opacity: 0.8;
  color: var(--text-light);
}

h1 {
  margin: 0 0 4px 0;
  font-size: 26px;
  font-weight: 600;
  color: var(--text-light);
}

.toggle {
  cursor: pointer;
  font-size: 14px;
  color: var(--text-light);
  opacity: 0.8;
}

  #statusBox {
    display: flex;
    gap: 10px;
    align-items: center;
  }

  .status-item {
    padding: 8px 12px;
    border-radius: 14px;
    background: var(--card-bg);
    box-shadow: 0 8px 18px rgba(0,0,0,0.08);
    font-weight: 700;
    color: var(--text-primary);
    font-size: 13px;
  }

.card {
  margin-top: 24px;
  padding: 20px;
  border-radius: 24px;
  background: var(--card-bg);
  box-shadow: 0 20px 40px rgba(0,0,0,0.1);
  transition: background 0.4s ease;
}

/* Consistent vertical rhythm inside the main card */
.card > * + * {
  margin-top: var(--space);
}

/* Inputs inside the main card use consistent padding and box-sizing */
.card input,
.card select,
.card input[type="date"],
.card textarea {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: none;
  background: var(--input-bg);
  color: var(--text-primary);
  box-sizing: border-box;
}

button {
  margin-top: 0;
  padding: 12px;
  width: 100%;
  border-radius: 18px;
  border: none;
  background: var(--button-bg);
  color: white;
  font-weight: 600;
  cursor: pointer;
}

ul {
  list-style: none;
  padding: 0;
  margin-top: calc(var(--space) * 1.5);
  overflow-y: auto;
  flex-grow: 1;
}

li {
  background: var(--li-bg);
  margin-bottom: var(--space);
  padding: 16px;
  border-radius: 18px;
  cursor: grab;
  box-shadow: 0 10px 20px rgba(0,0,0,0.08);
  color: var(--text-primary);
}

body.dark li {
  box-shadow: 0 8px 18px rgba(0,0,0,0.3);
}

.meta {
  font-size: 12px;
  opacity: 0.6;
  margin-top: 4px;
}

.completed {
  text-decoration: line-through;
  opacity: 0.5;
}
  </style>
</head>
<body>

<div class="app">

  <div class="header">
    <div>
      <div class="date">Today</div>
        <h1 id="todayDate"></h1>
      </div>
      <div id="statusBox">
        <div class="status-item" id="dailyCount">0/0</div>
        <div class="status-item" id="weeklyStreak">Streak: 0</div>
      </div>
    <div class="toggle" onclick="toggleDarkMode()">☀︎ / ☾</div>
  </div>

  <div class="card">
    <input id="habitName" placeholder="Habit name">
    <select id="habitCategory">
      <option value="Health">Health</option>
      <option value="Work">Work</option>
      <option value="Personal">Personal</option>
    </select>
    <input type="date" id="startDate">
    <input type="date" id="endDate">
    <button onclick="addHabit()">Add Habit</button>
  </div>

  <ul id="habitList"></ul>

</div>

<script>
let habits = JSON.parse(localStorage.getItem("habits")) || [];

// normalize older entries
habits = habits.map(h => ({ ...h, completions: h.completions || [] }));

function saveHabits() {
  localStorage.setItem("habits", JSON.stringify(habits));
}

function addHabit() {
  const name = document.getElementById("habitName").value;
  const category = document.getElementById("habitCategory").value;
  const startDate = document.getElementById("startDate").value;
  const endDate = document.getElementById("endDate").value;

  // startDate and endDate are optional now — only name is required
  if (!name) return;

  habits.push({
    id: Date.now(),
    name,
    category,
    startDate,
    endDate,
    completions: []
  });

  document.getElementById("habitName").value = "";
  saveHabits();
  renderHabits();
}

function toggleHabit(id) {
  const today = getISODate(new Date());
  habits = habits.map(h => {
    if (h.id !== id) return h;
    const hasToday = (h.completions || []).includes(today);
    const completions = new Set(h.completions || []);
    if (hasToday) completions.delete(today);
    else completions.add(today);
    return { ...h, completions: Array.from(completions) };
  });
  saveHabits();
  renderHabits();
}

function renderHabits() {
  const list = document.getElementById("habitList");
  list.innerHTML = "";

  const today = getISODate(new Date());
  let completedTodayCount = 0;

  habits.forEach(habit => {
    const li = document.createElement("li");
    li.draggable = true;
    li.dataset.id = habit.id;

    const doneToday = (habit.completions || []).includes(today);

    const meta = formatHabitMeta(habit);
    li.innerHTML = `
      <div class="${doneToday ? 'completed' : ''}"
        onclick="toggleHabit(${habit.id})">
        <strong>${habit.name}</strong>
        <div class="meta">
          ${meta}
        </div>
      </div>
    `;

    if (doneToday) completedTodayCount++;

    addDragEvents(li);
    list.appendChild(li);
  });

  updateStatus(completedTodayCount);
}

function updateStatus(completedTodayCount) {
  const dailyEl = document.getElementById("dailyCount");
  const streakEl = document.getElementById("weeklyStreak");
  dailyEl.innerText = `${completedTodayCount}/${habits.length}`;
  const streak = computeWeeklyStreak();
  streakEl.innerText = `Streak: ${streak}`;
}

// Helpers
function getISODate(d) {
  return new Date(d.getFullYear(), d.getMonth(), d.getDate()).toISOString().slice(0,10);
}

function getAllCompletedDatesSet() {
  const s = new Set();
  habits.forEach(h => (h.completions || []).forEach(d => s.add(d)));
  return s;
}

function formatHabitMeta(habit) {
  const parts = [];
  if (habit.category) parts.push(habit.category);
  const dates = [];
  if (habit.startDate) dates.push(habit.startDate);
  if (habit.endDate) dates.push(habit.endDate);
  if (dates.length) parts.push(dates.join(' → '));
  return parts.join(' • ');
}

function startOfWeekDate(date) {
  const d = new Date(date);
  // make Monday the first day of week
  const day = (d.getDay() + 6) % 7;
  d.setDate(d.getDate() - day);
  d.setHours(0,0,0,0);
  return d;
}

// Compute weekly streak: consecutive weeks (ending this week) where there are 4+ active days
function computeWeeklyStreak() {
  const completedDays = getAllCompletedDatesSet();
  if (completedDays.size === 0) return 0;

  const today = new Date();
  let weekStart = startOfWeekDate(today);

  let streak = 0;
  while (true) {
    // gather days in this week (Mon..Sun)
    let activeDays = 0;
    for (let i = 0; i < 7; i++) {
      const d = new Date(weekStart);
      d.setDate(weekStart.getDate() + i);
      const ds = getISODate(d);
      if (completedDays.has(ds)) activeDays++;
    }
    // majority threshold (4+ days) counts as an active week
    if (activeDays >= 4) {
      streak++;
      // move to previous week
      weekStart.setDate(weekStart.getDate() - 7);
    } else {
      break;
    }
  }

  return streak;
}

/* Drag & Drop */
let draggedId = null;

function addDragEvents(element) {
  element.addEventListener("dragstart", e => {
    draggedId = Number(e.target.dataset.id);
  });

  element.addEventListener("dragover", e => {
    e.preventDefault();
  });

  element.addEventListener("drop", e => {
    e.preventDefault();
    const targetId = Number(e.target.closest("li").dataset.id);
    reorderHabits(draggedId, targetId);
  });
}

function reorderHabits(dragId, targetId) {
  const dragIndex = habits.findIndex(h => h.id === dragId);
  const targetIndex = habits.findIndex(h => h.id === targetId);

  const [moved] = habits.splice(dragIndex, 1);
  habits.splice(targetIndex, 0, moved);

  saveHabits();
  renderHabits();
}

function setTodayDate() {
  const options = { weekday: 'short', month: 'short', day: 'numeric' };
  document.getElementById("todayDate").innerText =
    new Date().toLocaleDateString(undefined, options);
}

setTodayDate();
function toggleDarkMode() {
  document.body.classList.toggle("dark");
  const isDark = document.body.classList.contains("dark");
  localStorage.setItem("darkMode", isDark);
}

function loadTheme() {
  const savedTheme = localStorage.getItem("darkMode");
  if (savedTheme === "true") {
    document.body.classList.add("dark");
  }
}
setTodayDate();
loadTheme();
renderHabits();
</script>

</body>
</html>